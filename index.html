<head>
    <script src="https://rawgit.com/pixijs/pixi.js/dev/bin/pixi.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/ascetic.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>

    <script src="https://rawgit.com/davidfig/renderer/master/renderer.js"></script>
    <script src="https://rawgit.com/davidfig/debug/master/debug.js"></script>
    <script src="https://rawgit.com/davidfig/update/master/update.js"></script>
    <script src="https://rawgit.com/davidfig/animate/master/animate.js"></script>
    <script src="https://rawgit.com/davidfig/animate/master/easing.js"></script>
    <script src="https://rawgit.com/davidfig/intersects/master/intersects.js"></script>

    <!-- for local testing -->
    <!--<script src="../renderer/renderer.js"></script>
    <script src="../debug/debug.js"></script>
    <script src="../update/update.js"></script>
    <script src="../animate/animate.js"></script>
    <script src="../animate/easing.js"></script>
    <script src="../intersects/intersects.js"></script>-->

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .title {
            margin-top: 1%;
            margin-left: 15%;
            font-size: 200%;
        }
        #code {
            left: 15%;
            width: 80%;
            position: absolute;
            word-wrap: break-word;
            z-index: -1;
        }
        .hljs {
            display: block;
            overflow-x: auto;
            padding: 0.5em;
            background: rgba(0, 0, 100, 0.02);
        }
        .hljs-comment {
            color: blue;
        }
    </style>
</head>
<body>
    <div class="title">Example for <a href="https://github.com/davidfig/intersects/">github.com/davidfig/intersects/</a></div>
    <pre><code class="javascript" id="code"></code></pre>
    <script id="sample">

        Debug.init();

        // set up renderer
        var renderer;
        pixi();

        // initialize animation
        Animate.init();

        // create examples
        pointInContainer(100, 100);
        pointInBox(600, 120);
        lineLine(100, 350);
        lineContainerRotated(800, 100);
        displayObjects(950, 400);
        circleCircle(300, 300);
        displayObjectAABB(250, 100);
        circleContainer(100, 610);

        // point and container
        function pointInContainer(x, y)
        {
            var s = square(100, 0x00ff00, x, y);
            var c = circle(5, 0, x, y);
            text('point-container', x, y + 68);
            Animate.to(c, {x: x * 2, y: y * 1.25}, 2000, {renderer: renderer, reverse: true, repeat: true, onEach: function()
                {
                    s.tint = Intersects.pointContainer(c.position, s) ? 0xff0000 : 0x00ff00;
                }}, Easing.easeInOutSine);
        }

        // point and box
        function pointInBox(x, y)
        {
            var buffer = square(100, 0, x, y);
            buffer.alpha = 0.25;
            var s = square(80, 0x00ff00, x, y);
            var rect = {x: s.x, y: y, width: s.width, height: s.height};
            var c = circle(5, 0, x + 75, y);
            text('point-box (buffer)', x, y + 68);
            Animate.to(c, {x: x - 100, y: y - 20}, 4000, {renderer: renderer, reverse: true, repeat: true, onEach: function()
                {
                    s.tint = Intersects.pointBox(c.position, rect, 10) ? 0xff0000 : 0x00ff00;
                }}, Easing.easeInOutSine);
        }

        // line and line
        function lineLine(x, y)
        {
            var g = renderer.addChild(new PIXI.Graphics());
            g.alpha = 0.5;
            text('line-line', x, y + 118);
            var l1 = {x: x, y: y};
            var l2 = {x: x, y: y + 100};
            var p1 = {x: x + 100, y: y};
            var p2 = {x: x + 50, y: y + 100};
            var move = {x: 0};
            Animate.to(p1, {x: x - 75}, 2750, {renderer: renderer, reverse: true, repeat: true, onEach: function()
                {
                    g.clear();
                    line(g, l1, l2, 0);
                    var intersect = Intersects.lineLine(l1, l2, p1, p2);
                    line(g, p1, p2, intersect ? 0xff0000 : 0x00ff00);
                }}, Easing.easeInOutSine);
        }

        // line and non-axis aligned rectangle
        function lineContainerRotated(x, y)
        {
            var g = renderer.addChild(new PIXI.Graphics());
            g.alpha = 0.5;
            text('line-container (non-axis aligned)', x, y + 118);
            var p1 = new PIXI.Point(x, y);
            var p2 = new PIXI.Point(x, y + 100);
            line(g, p1, p2, 0);
            var s = square(50, 0x00ff00, x + 100, y + 50);
            s.alpha = 0.5;
            Animate.to(s, {x: x - 100, y: y - 75, rotation: 2 * Math.PI}, 3000, {onEach: function()
                {
                    var intersect = Intersects.lineContainerRotated(p1, p2, s);
                    s.tint = intersect ? 0xff0000 : 0x00ff00;
                }, reverse: true, repeat: true}, Easing.easeInOutSine);

        }

        // two non-axis aligned rectangles
        function displayObjects(x, y)
        {
            // test a container
            var s1 = renderer.addChild(new PIXI.Container());
            s1.position.set(x - 200, y - 50);
            s1.addChild(square(100, 0x00ff00, 0, 0));

            // test a sprite
            var s2 = square(75, 0x00ff00, x, y);
            s1.alpha = s2.alpha = 0.5;
            text('Display Objects\n(non-axis aligned)', x - 100, y + 110);
            Animate.to(s1, {x: x + 100, y: y + 75, rotation: Math.PI * 2}, 4000, {onEach: function()
                {
                    var intersect = Intersects.displayObjects(s1, s2);
                    s1.children[0].tint = s2.tint = intersect ? 0xff0000 : 0x00ff00;
                }, reverse: true, repeat: true}, Easing.easeInOutSine);
            Animate.to(s2, {x: x - 200, y: y - 25, rotation: Math.PI}, 3000, {repeat: true, reverse: true}, Easing.easeInOutSine);
        }

        function circleCircle(x, y)
        {
            var c1 = circle(50, 0x00ff00, x - 100, y);
            var c2 = circle(74, 0x00ff00, x + 100, y + 50);
            text('circle-circle', x, y + 100);
            c1.alpha = c2.alpha = 0.5;
            Animate.to(c1, {x: x + 100, y: y + 25}, 1000, {repeat: true, reverse: true, onEach: function()
                {
                    var intersect = Intersects.circleCircle(c1, c2);
                    c1.tint = c2.tint = intersect ? 0xff0000 : 0x00ff00;
                }}, Easing.easeInOutSine);
            Animate.to(c2, {x: x - 100, y: y - 25}, 750, {repeat: true, reverse: true}, Easing.easeInOutSine);
        }

        function displayObjectAABB(x, y)
        {
            var AABB = {x: x + 50, y: y + 50, width: 50, height: 50};
            var aabb = renderer.addChild(PIXI.Sprite.fromImage('box.png'));
            aabb.tint = 0x00ff00;
            aabb.width = aabb.height = AABB.width;
            aabb.position.set(AABB.x, AABB.y);
            var sprite = renderer.addChild(PIXI.Sprite.fromImage('box.png'));
            sprite.position.set(x + 125, y + 50);
            sprite.anchor.set(0.5);
            sprite.width = sprite.height = 75;
            sprite.tint = 0x00ff00;
            aabb.alpha = sprite.alpha = 0.5;
            Animate.to(sprite, {x: x, y: y, rotation: Math.PI / 8}, 600, {repeat: true, reverse: true, onEach:
                function()
                {
                    var intersect = Intersects.displayObjectAABB(sprite, AABB, renderer.stage);
                    sprite.tint = aabb.tint = intersect ? 0xff0000 : 0x00ff00;
                }}, Easing.easeInOutSine);
        }

        function circleContainer(x, y)
        {
            var circ = {x: x - 30, y: y - 30, radius: 75};
            var c = circle(circ.radius * 2, 0x00ff00, circ.x, circ.y);
            var rectangle = square(50, 0x00ff00, x + 150, y + 30);

            Animate.to(rectangle, {rotation: Math.PI * 2}, 13000, {repeat: true});
            Animate.to(rectangle, {x: x + 50}, 2000, {repeat: true, reverse: true}, Easing.easeInOutSine);

            Animate.to([c, circ], {x: x + 100, y: y - 10}, 11500, {repeat: true, reverse: true, onEach:
                function()
                {
                    var intersect = Intersects.displayObjectCircle(rectangle, circ);
                    c.tint = rectangle.tint = intersect ? 0xff0000 : 0x00ff00;
                }}, Easing.easeInOutSine);

            var t = text('Circle-Container', x, y + 120);
            t.x += t.width / 2;
        }

        // initialize renderer and update loop for animation (see github.com/davidfig/renderer/, github.com/davidfig/update, and github.com/davidfig/animate)
        function pixi()
        {
            Update.init();
            renderer = new Renderer({transparent: true});
            renderer.canvas.style.pointerEvents = 'none';
            Update.update();
        }

        // draw a square
        function square(size, color, x, y)
        {
            var sprite = PIXI.Sprite.fromImage('box.png');
            renderer.addChild(sprite);
            sprite.anchor.set(0.5);
            sprite.width = sprite.height = size;
            sprite.position.set(x, y);
            sprite.tint = color;
            return sprite;
        }

        // draw a triangle (for future expansion)
        function triangle(size, color)
        {
            var half = size / 2;
            var g = new PIXI.Graphics();
            renderer.addChild(g);
            g.beginFill(color);
            g.moveTo(0, -half);
            g.lineTo(-half, half);
            g.lineTo(half, half);
            g.closePath();
            g.endFill();
            return g;
        }

        // draw a circle
        function circle(size, color, x, y)
        {
            var circle = PIXI.Sprite.fromImage('circle.png');
            circle.anchor.set(0.5);
            circle.width = circle.height = size;
            renderer.addChild(circle);
            circle.tint = color;
            circle.position.set(x, y);
            return circle;
        }

        // draw a line
        function line(g, p1, p2, color)
        {
            g.lineStyle(10, color);
            g.moveTo(p1.x, p1.y);
            g.lineTo(p2.x, p2.y);
        }

        // draw text
        function text(text, x, y)
        {
            var c = renderer.addChild(new PIXI.Container());
            var back = c.addChild(PIXI.Sprite.fromImage('box.png'));
            back.anchor.set(0.5);
            back.tint = 0;
            back.alpha = 0.1;
            var words = c.addChild(new PIXI.Text(text, {fontSize: '14px', align: 'center'}));
            words.anchor.set(0.5);
            c.position.set(x, y);
            back.width = words.width * 1.25;
            back.height = words.height * 1.25;
            return c;
        }

    </script>
    <script>
        window.onload = function()
        {
            var code = document.getElementById('code');
            var script = document.getElementById('sample');
            code.innerHTML = script.innerHTML;
            hljs.highlightBlock (code);
        };
    </script>
</body>